name: openstack/cinder/cinder-backup
enabled: {{ enable_cinder | bool }}
container:
  image: "{{ cinder_backup_image }}:{{ cinder_backup_tag }}"
service:
  daemon:
    dependencies: [cinder_ansible_tasks/create_user,
                   keystone_ansible_tasks/running,
                   rabbitmq/daemon]
    command: /usr/bin/cinder-backup
    files:
      cinder.conf.j2:
        source: ["config/cinder/templates/cinder.conf.j2",
                 "config/cinder/templates/cinder-{{ cinder_volume_driver }}.conf.j2",
{% if cinder_volume_driver == "ceph" %}
                 "config/cinder/templates/cinder-backup-{{ cinder_volume_driver }}.conf.j2",
{% endif %}
                 "/etc/kolla-mesos/config/global.conf",
                 "/etc/kolla-mesos/config/database.conf",
                 "/etc/kolla-mesos/config/messaging.conf",
                 "/etc/kolla-mesos/config/cinder.conf",
                 "/etc/kolla-mesos/config/cinder/cinder-backup.conf"]
        dest: /etc/cinder/cinder.conf
        owner: cinder
        perm: "0600"