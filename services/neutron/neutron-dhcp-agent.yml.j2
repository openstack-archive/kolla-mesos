name: openstack/neutron/neutron-dhcp-agent
container:
  image: "{{ neutron_dhcp_agent_image }}:{{ neutron_dhcp_agent_tag }}"
  privileged: true
service:
  volumes:
    - containerPath: "/run"
      hostPath: "/run"
      mode: RW
  daemon:
    command: neutron-dhcp-agent --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/dhcp_agent.ini
    files:
      neutron.conf.j2:
        source: ["config/neutron/templates/neutron.conf.j2",
                 {% if neutron_plugin_agent == 'linuxbridge' %}
                 "config/neutron/templates/neutron.linuxbridge.conf.j2"
                 {% elif neutron_plugin_agent == 'openvswitch' %}
                 "config/neutron/templates/neutron.openvswitch.conf.j2"
                 {% endif %}]
        dest: /etc/neutron/neutron.conf
        owner: neutron
        perm: "0600"
      ml2_conf.ini.j2:
        source: ["config/neutron/templates/ml2_conf.ini.j2",
                 {% if neutron_plugin_agent == 'linuxbridge' %}
                 "config/neutron/templates/ml2_conf.linuxbridge.conf.j2"
                 {% elif neutron_plugin_agent == 'openvswitch' %}
                 "config/neutron/templates/ml2_conf.openvswitch.conf.j2"
                 {% endif %}]
        dest: /etc/neutron/plugins/ml2/ml2_conf.ini
        owner: neutron
        perm: "0600"
      dhcp_agent.ini.j2:
        source: ["config/neutron/templates/dhcp_agent.ini.j2"]
        dest: /etc/neutron/dhcp_agent.ini
        owner: neutron
        perm: "0600"
      dnsmasq.conf.j2:
        source: "config/neutron/templates/dnsmasq.conf.j2"
        dest: /etc/neutron/dnsmasq.conf
        owner: neutron
        perm: "0600"
