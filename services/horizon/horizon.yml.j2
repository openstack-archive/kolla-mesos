{% set apache_cmd = 'apache2' if kolla_base_distro in ['ubuntu', 'debian'] else 'httpd' %}
{% set apache_dir = 'apache2/conf-enabled' if kolla_base_distro in ['ubuntu', 'debian'] else 'httpd/conf.d' %}
{% set apache_conf = 'horizon.conf' if kolla_base_distro in ['ubuntu', 'debian'] else '000-default.conf' %}
name: openstack/horizon/horizon
enabled: {{ enable_horizon | bool }}
container:
  image: "{{ horizon_image }}:{{ horizon_tag }}"
service:
  daemon:
    command: /usr/sbin/{{ apache_cmd }} -DFOREGROUND
    dependencies: [horizon/bootstrap, memcached/daemon]
  mem: {{ horizon_mem }}
  cpus: {{ horizon_cpus }}

commands:
  bootstrap:
    command: kolla_extend_start
    env:
      KOLLA_BOOTSTRAP:
    files:
      local_settings:
        source: config/horizon/templates/local_settings.j2
        dest: /etc/openstack-dashboard/local_settings
        owner: horizon
        perm: "0644"
      000-default.conf:
        source: config/horizon/templates/horizon.conf.j2
        dest: /etc/{{ apache_dir }}/{{ apache_conf }}
        owner: horizon
        perm: "0644"
