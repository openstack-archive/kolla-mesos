name: openstack/nova/nova-novncproxy
enabled: {{ enable_nova | bool and nova_console == 'novnc' }}
container:
  image: "{{ nova_novncproxy_image }}:{{ nova_novncproxy_tag }}"
service:
  daemon:
    dependencies: [nova-conductor/db_sync, nova_ansible_tasks/create_user]
    command: nova-novncproxy --config-file /etc/nova/nova.conf --config-file /etc/nova/nova-override.conf
    files:
      nova-override.conf:
        source: ["/etc/kolla-mesos/config/global.conf",
                 "/etc/kolla-mesos/config/database.conf",
                 "/etc/kolla-mesos/config/messaging.conf",
                 "/etc/kolla-mesos/config/nova.conf",
                 "/etc/kolla-mesos/config/nova/nova-novncproxy.conf"]
        dest: /etc/nova/nova-override.conf
        owner: nova
        perm: "0600"
      nova.conf.j2:
        source: "config/nova/templates/nova.conf.j2"
        dest: /etc/nova/nova.conf
        owner: nova
        perm: "0600"
  mem: {{ api_endpoint_mem }}
  cpus: {{ api_endpoint_cpus }}
