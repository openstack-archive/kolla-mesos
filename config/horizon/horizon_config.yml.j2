{% set apache_cmd = 'apache2' if kolla_base_distro in ['ubuntu', 'debian'] else 'httpd' %}
{% set apache_dir = 'apache2/conf-enabled' if kolla_base_distro in ['ubuntu', 'debian'] else 'httpd/conf.d' %}
config:
  horizon:
    horizon:
      extend_start.sh.j2:
        source: config/horizon/templates/extend_start.sh.j2
        dest: /usr/local/bin/kolla_mesos_extend_start
        owner: apache
        perm: "0755"
      000-default.conf:
        source: config/horizon/templates/horizon.conf.j2
        dest: /etc/{{ apache_dir }}/000-default.conf
        owner: apache
        perm: "0600"
      local_settings:
        source: config/horizon/templates/local_settings.j2
        dest: /etc/openstack-dashboard/local_settings
        owner: horizon
        perm: "0600"
commands:
  horizon:
    horizon:
      setup:
        run_once: False
        command: kolla_mesos_extend_start
      horizon:
        command: /usr/sbin/{{ apache_cmd }} -DFOREGROUND
        daemon: True
        run_once: False
