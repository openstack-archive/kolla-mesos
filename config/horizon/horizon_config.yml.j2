{% set apache_cmd = 'apache2' if kolla_base_distro in ['ubuntu', 'debian'] else 'httpd' %}
{% set apache_dir = 'apache2/conf-enabled' if kolla_base_distro in ['ubuntu', 'debian'] else 'httpd/conf.d' %}
{% set apache_conf = 'horizon.conf' if kolla_base_distro in ['ubuntu', 'debian'] else '000-default.conf' %}
config:
  horizon:
    horizon:
      extend_start.sh.j2:
        source: config/horizon/templates/extend_start.sh.j2
        dest: /usr/local/bin/kolla_mesos_extend_start
        owner: horizon
        perm: "0755"
      000-default.conf:
        source: config/horizon/templates/horizon.conf.j2
        dest: /etc/{{ apache_dir }}/{{ apache_conf }}
        owner: horizon
        perm: "0644"
      local_settings:
        source: config/horizon/templates/local_settings.j2
        dest: /etc/openstack-dashboard/local_settings
        owner: horizon
        perm: "0644"
commands:
  horizon:
    horizon:
      setup:
        run_once: False
        command: bash kolla_mesos_extend_start
        register: /kolla/{{ deployment_id }}/variables/horizon_setup
      horizon:
        command: /usr/sbin/{{ apache_cmd }} -DFOREGROUND
        register: /kolla/{{ deployment_id }}/variables/horizon
        daemon: True
        run_once: False
