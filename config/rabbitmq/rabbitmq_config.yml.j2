config:
  rabbitmq:
    rabbitmq:
      rabbitmq-env.conf.j2:
        source: config/rabbitmq/templates/rabbitmq-env.conf.j2
        dest: /etc/rabbitmq/rabbitmq-env.conf
        owner: rabbitmq
        perm: "0600"
      rabbitmq.config.j2:
        source: config/rabbitmq/templates/rabbitmq.config.j2
        dest: /etc/rabbitmq/rabbitmq.config
        owner: rabbitmq
        perm: "0600"
      rabbitmq_clusterer.config.j2:
        source: config/rabbitmq/templates/rabbitmq_clusterer.config.j2
        dest: /etc/rabbitmq/rabbitmq_clusterer.config
        owner: rabbitmq
        perm: "0600"
commands:
  rabbitmq:
    rabbitmq:
      bootstrap:
        run_once: True
        command: kolla_extend_start
        env:
          KOLLA_BOOTSTRAP:
          RABBITMQ_CLUSTER_COOKIE: "{{ rabbitmq_cluster_cookie }}"
      server:
        command: /usr/sbin/rabbitmq-server
        daemon: True
        dependencies: [rabbitmq/bootstrap]
