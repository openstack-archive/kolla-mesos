config:
  rabbitmq:
    rabbitmq:
      kolla_mesos_start.py:
        source: config/kolla_mesos_start.py
        dest: /kolla_mesos_start.py
      rabbitmq-env.conf.j2:
        source: config/rabbitmq/templates/rabbitmq-env.conf.j2
        dest: /etc/rabbitmq/rabbitmq-env.conf
        owner: rabbitmq
        perm: "0600"
      rabbitmq.config.j2:
        source: config/rabbitmq/templates/rabbitmq.config.j2
        dest: /etc/rabbitmq/rabbitmq.config
        owner: rabbitmq
        perm: "0600"
      rabbitmq_clusterer.config.j2:
        source: config/rabbitmq/templates/rabbitmq_clusterer.config.j2
        dest: /etc/rabbitmq/rabbitmq_clusterer.config
        owner: rabbitmq
        perm: "0600"
commands:
  rabbitmq:
    rabbitmq:
      bootstrap:
        command: kolla_extend_start
        env:
          KOLLA_BOOTSTRAP: "yes"
          RABBITMQ_CLUSTER_COOKIE: "{{ rabbitmq_cluster_cookie }}"
        run_once: True
        register: /kolla/variables/rabbitmq_bootstrap/.done
      rabbitmq-server:
        command: /usr/sbin/rabbitmq-server
        daemon: True
        run_once: False
        requires: [/kolla/variables/rabbitmq_bootstrap/.done]
